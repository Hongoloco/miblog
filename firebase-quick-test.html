<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Firebase Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #f0f0f0;
        }
        .test-result {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #333;
        }
        .success { background: #2d5a2d; border-color: #4caf50; }
        .error { background: #5a2d2d; border-color: #f44336; }
        .warning { background: #5a4d2d; border-color: #ff9800; }
        .info { background: #2d4d5a; border-color: #2196f3; }
        button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background: #357abd;
        }
        .config-box {
            background: #2a2a2a;
            border: 1px solid #444;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        pre {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üî• Firebase Quick Test</h1>
    
    <div class="config-box">
        <h3>Tu configuraci√≥n actual:</h3>
        <pre id="currentConfig">Cargando...</pre>
    </div>
    
    <div>
        <button onclick="testConnection()">üîç Test Conexi√≥n</button>
        <button onclick="testWrite()">‚úçÔ∏è Test Escritura</button>
        <button onclick="testRead()">üìñ Test Lectura</button>
        <button onclick="showInstructions()">üìã Mostrar Instrucciones</button>
    </div>
    
    <div id="results"></div>
    
    <div id="instructions" style="display: none;">
        <h2>üìã Instrucciones para arreglar Firebase</h2>
        <div class="test-result info">
            <h3>1. Ve a Firebase Console</h3>
            <p>Abre: <a href="https://console.firebase.google.com" target="_blank">https://console.firebase.google.com</a></p>
            <p>Selecciona tu proyecto: <strong>mi-b-99ca8</strong></p>
        </div>
        
        <div class="test-result info">
            <h3>2. Configura Realtime Database</h3>
            <p>‚Ä¢ Ve a "Realtime Database" en el men√∫ lateral</p>
            <p>‚Ä¢ Si no existe, haz clic en "Crear base de datos"</p>
            <p>‚Ä¢ Elige la regi√≥n m√°s cercana (us-central1)</p>
            <p>‚Ä¢ Selecciona "Empezar en modo de prueba"</p>
        </div>
        
        <div class="test-result info">
            <h3>3. Configura las reglas de seguridad</h3>
            <p>‚Ä¢ Ve a la pesta√±a "Reglas"</p>
            <p>‚Ä¢ Copia y pega estas reglas:</p>
            <pre>{
  "rules": {
    ".read": true,
    ".write": true
  }
}</pre>
            <p>‚Ä¢ Haz clic en "Publicar"</p>
        </div>
        
        <div class="test-result info">
            <h3>4. Verifica la URL</h3>
            <p>‚Ä¢ Ve a la pesta√±a "Datos"</p>
            <p>‚Ä¢ Verifica que la URL sea: <strong>https://mi-b-99ca8-default-rtdb.firebaseio.com</strong></p>
        </div>
    </div>
    
    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    
    <script>
        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> - ${message}`;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }
        
        function showCurrentConfig() {
            const configEl = document.getElementById('currentConfig');
            if (typeof firebaseConfig !== 'undefined') {
                configEl.textContent = JSON.stringify(firebaseConfig, null, 2);
            } else {
                configEl.textContent = 'ERROR: firebaseConfig no encontrado';
            }
        }
        
        function testConnection() {
            addResult('üîç Iniciando test de conexi√≥n...', 'info');
            
            // Verificar Firebase
            if (typeof firebase === 'undefined') {
                addResult('‚ùå Firebase SDK no cargado', 'error');
                return;
            }
            
            if (firebase.apps.length === 0) {
                addResult('‚ùå Firebase no inicializado', 'error');
                return;
            }
            
            addResult('‚úÖ Firebase SDK y configuraci√≥n OK', 'success');
            
            // Test conexi√≥n
            try {
                const database = firebase.database();
                database.ref('.info/connected').once('value')
                    .then(snapshot => {
                        if (snapshot.val()) {
                            addResult('‚úÖ Conexi√≥n a Firebase exitosa', 'success');
                        } else {
                            addResult('‚ùå Sin conexi√≥n a Firebase', 'error');
                        }
                    })
                    .catch(error => {
                        addResult(`‚ùå Error de conexi√≥n: ${error.message}`, 'error');
                        addResult(`üìã C√≥digo: ${error.code}`, 'warning');
                    });
            } catch (error) {
                addResult(`‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        function testWrite() {
            addResult('‚úçÔ∏è Testing escritura...', 'info');
            
            if (typeof firebase === 'undefined' || firebase.apps.length === 0) {
                addResult('‚ùå Firebase no disponible', 'error');
                return;
            }
            
            const database = firebase.database();
            const testRef = database.ref('test-write');
            
            const testData = {
                message: 'Test de escritura',
                timestamp: Date.now(),
                random: Math.random()
            };
            
            testRef.set(testData)
                .then(() => {
                    addResult('‚úÖ Escritura exitosa', 'success');
                    // Limpiar despu√©s de 3 segundos
                    setTimeout(() => {
                        testRef.remove();
                        addResult('üßπ Datos de prueba limpiados', 'info');
                    }, 3000);
                })
                .catch(error => {
                    addResult(`‚ùå Error de escritura: ${error.message}`, 'error');
                    addResult(`üìã C√≥digo: ${error.code}`, 'warning');
                    
                    if (error.code === 'PERMISSION_DENIED') {
                        addResult('‚ö†Ô∏è Problema de permisos. Verifica las reglas de seguridad.', 'warning');
                    }
                });
        }
        
        function testRead() {
            addResult('üìñ Testing lectura...', 'info');
            
            if (typeof firebase === 'undefined' || firebase.apps.length === 0) {
                addResult('‚ùå Firebase no disponible', 'error');
                return;
            }
            
            const database = firebase.database();
            
            // Primero escribir algo para leer
            const testRef = database.ref('test-read');
            const testData = {
                message: 'Test de lectura',
                timestamp: Date.now()
            };
            
            testRef.set(testData)
                .then(() => {
                    addResult('‚úÖ Datos de prueba creados', 'success');
                    
                    // Ahora leer
                    return testRef.once('value');
                })
                .then(snapshot => {
                    const data = snapshot.val();
                    if (data) {
                        addResult('‚úÖ Lectura exitosa', 'success');
                        addResult(`üìÑ Datos le√≠dos: ${JSON.stringify(data)}`, 'info');
                    } else {
                        addResult('‚ö†Ô∏è No se encontraron datos', 'warning');
                    }
                    
                    // Limpiar
                    testRef.remove();
                })
                .catch(error => {
                    addResult(`‚ùå Error de lectura: ${error.message}`, 'error');
                    addResult(`üìã C√≥digo: ${error.code}`, 'warning');
                });
        }
        
        function showInstructions() {
            const instructions = document.getElementById('instructions');
            instructions.style.display = instructions.style.display === 'none' ? 'block' : 'none';
        }
        
        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            showCurrentConfig();
            
            // Auto-test despu√©s de 1 segundo
            setTimeout(() => {
                testConnection();
            }, 1000);
        });
    </script>
</body>
</html>
