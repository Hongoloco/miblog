<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Final - VerificaciÃ³n Completa</title>
    <link rel="stylesheet" href="assets/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;600&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <h1>ğŸ§ª Test Final - VerificaciÃ³n Completa</h1>
        <nav>
            <ul>
                <li><a href="index.html">ğŸ  Inicio</a></li>
                <li><a href="blog-simple.html">ğŸ“ Blog Simple</a></li>
                <li><a href="blog-viewer.html">ğŸ“– Blog Viewer</a></li>
                <li><a href="resources.html">ğŸ”— Recursos</a></li>
                <li><a href="about.html">ğŸ“‹ Sobre mÃ­</a></li>
                <li><a href="contact.html">ğŸ“ Contacto</a></li>
                <li><a href="admin.html">ğŸ” Admin</a></li>
            </ul>
        </nav>
    </header>
    
    <main>
        <section class="test-container">
            <h2>ğŸ” Estado del Sistema</h2>
            
            <div class="test-section">
                <h3>ğŸ”¥ ConexiÃ³n Firebase</h3>
                <div id="firebase-status" class="status-item">
                    <span class="status-indicator">â³</span>
                    <span class="status-text">Verificando conexiÃ³n...</span>
                </div>
            </div>
            
            <div class="test-section">
                <h3>ğŸ“ Sistema de Blog</h3>
                <div id="blog-status" class="status-item">
                    <span class="status-indicator">â³</span>
                    <span class="status-text">Verificando posts...</span>
                </div>
                <div id="blog-count" class="status-detail"></div>
            </div>
            
            <div class="test-section">
                <h3>ğŸ”— Sistema de Recursos</h3>
                <div id="resources-status" class="status-item">
                    <span class="status-indicator">â³</span>
                    <span class="status-text">Verificando recursos...</span>
                </div>
                <div id="resources-count" class="status-detail"></div>
            </div>
            
            <div class="test-section">
                <h3>ğŸ“§ Mensajes de Contacto</h3>
                <div id="contact-status" class="status-item">
                    <span class="status-indicator">â³</span>
                    <span class="status-text">Verificando mensajes...</span>
                </div>
                <div id="contact-count" class="status-detail"></div>
            </div>
            
            <div class="test-section">
                <h3>ğŸ§ª Test de Funcionalidad</h3>
                <button id="test-create-post" class="btn-primary">Crear Post de Prueba</button>
                <button id="test-create-resource" class="btn-secondary">Crear Recurso de Prueba</button>
                <button id="test-send-message" class="btn-secondary">Enviar Mensaje de Prueba</button>
                <div id="test-results" class="test-results"></div>
            </div>
            
            <div class="test-section">
                <h3>ğŸ“Š Resultados del Test</h3>
                <div id="final-results" class="final-results">
                    <p>Ejecutando pruebas...</p>
                </div>
            </div>
        </section>
    </main>
    
    <footer>
        <p>Â© 2025 Ale Gallo - Test Final</p>
    </footer>
    
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    
    <script>
        // Sistema de testing completo
        const TestSystem = {
            results: {
                firebase: false,
                blog: false,
                resources: false,
                contact: false,
                functionality: false
            },
            
            init: function() {
                console.log('ğŸ§ª Iniciando sistema de testing...');
                this.testFirebase();
                this.testBlog();
                this.testResources();
                this.testContact();
                this.setupTestButtons();
            },
            
            testFirebase: function() {
                try {
                    if (typeof firebase !== 'undefined' && firebase.database) {
                        firebase.database().ref('.info/connected').on('value', (snapshot) => {
                            const connected = snapshot.val();
                            this.updateStatus('firebase-status', connected, 
                                connected ? 'Firebase conectado correctamente' : 'Firebase desconectado');
                            this.results.firebase = connected;
                            this.updateFinalResults();
                        });
                    } else {
                        this.updateStatus('firebase-status', false, 'Firebase no estÃ¡ disponible');
                        this.results.firebase = false;
                        this.updateFinalResults();
                    }
                } catch (error) {
                    this.updateStatus('firebase-status', false, 'Error al conectar Firebase: ' + error.message);
                    this.results.firebase = false;
                    this.updateFinalResults();
                }
            },
            
            testBlog: function() {
                BlogDB.getBlogPosts().then(snapshot => {
                    const posts = snapshot.val();
                    const count = posts ? Object.keys(posts).length : 0;
                    
                    this.updateStatus('blog-status', true, 'Sistema de blog funcionando');
                    document.getElementById('blog-count').textContent = `Posts encontrados: ${count}`;
                    this.results.blog = true;
                    this.updateFinalResults();
                }).catch(error => {
                    this.updateStatus('blog-status', false, 'Error en sistema de blog: ' + error.message);
                    this.results.blog = false;
                    this.updateFinalResults();
                });
            },
            
            testResources: function() {
                database.ref('resources').once('value').then(snapshot => {
                    const resources = snapshot.val();
                    const count = resources ? Object.keys(resources).length : 0;
                    
                    this.updateStatus('resources-status', true, 'Sistema de recursos funcionando');
                    document.getElementById('resources-count').textContent = `Recursos encontrados: ${count}`;
                    this.results.resources = true;
                    this.updateFinalResults();
                }).catch(error => {
                    this.updateStatus('resources-status', false, 'Error en sistema de recursos: ' + error.message);
                    this.results.resources = false;
                    this.updateFinalResults();
                });
            },
            
            testContact: function() {
                database.ref('contact-messages').once('value').then(snapshot => {
                    const messages = snapshot.val();
                    const count = messages ? Object.keys(messages).length : 0;
                    
                    this.updateStatus('contact-status', true, 'Sistema de contacto funcionando');
                    document.getElementById('contact-count').textContent = `Mensajes encontrados: ${count}`;
                    this.results.contact = true;
                    this.updateFinalResults();
                }).catch(error => {
                    this.updateStatus('contact-status', false, 'Error en sistema de contacto: ' + error.message);
                    this.results.contact = false;
                    this.updateFinalResults();
                });
            },
            
            setupTestButtons: function() {
                document.getElementById('test-create-post').addEventListener('click', () => {
                    this.testCreatePost();
                });
                
                document.getElementById('test-create-resource').addEventListener('click', () => {
                    this.testCreateResource();
                });
                
                document.getElementById('test-send-message').addEventListener('click', () => {
                    this.testSendMessage();
                });
            },
            
            testCreatePost: function() {
                const testPost = {
                    title: 'Test Post - ' + new Date().toLocaleString(),
                    content: 'Este es un post de prueba creado por el sistema de testing.',
                    summary: 'Post de prueba para verificar funcionalidad'
                };
                
                BlogDB.addBlogPost(testPost.title, testPost.content, testPost.summary)
                    .then(() => {
                        this.addTestResult('âœ… Post de prueba creado exitosamente');
                        this.testBlog(); // Actualizar contador
                    })
                    .catch(error => {
                        this.addTestResult('âŒ Error al crear post: ' + error.message);
                    });
            },
            
            testCreateResource: function() {
                const testResource = {
                    title: 'Test Resource - ' + new Date().toLocaleString(),
                    url: 'https://ejemplo.com',
                    description: 'Recurso de prueba creado por el sistema de testing',
                    category: 'Testing'
                };
                
                database.ref('resources').push(testResource)
                    .then(() => {
                        this.addTestResult('âœ… Recurso de prueba creado exitosamente');
                        this.testResources(); // Actualizar contador
                    })
                    .catch(error => {
                        this.addTestResult('âŒ Error al crear recurso: ' + error.message);
                    });
            },
            
            testSendMessage: function() {
                const testMessage = {
                    name: 'Test User',
                    email: 'test@ejemplo.com',
                    message: 'Este es un mensaje de prueba del sistema de testing',
                    timestamp: Date.now(),
                    read: false
                };
                
                database.ref('contact-messages').push(testMessage)
                    .then(() => {
                        this.addTestResult('âœ… Mensaje de prueba enviado exitosamente');
                        this.testContact(); // Actualizar contador
                    })
                    .catch(error => {
                        this.addTestResult('âŒ Error al enviar mensaje: ' + error.message);
                    });
            },
            
            updateStatus: function(elementId, success, message) {
                const element = document.getElementById(elementId);
                const indicator = element.querySelector('.status-indicator');
                const text = element.querySelector('.status-text');
                
                indicator.textContent = success ? 'âœ…' : 'âŒ';
                text.textContent = message;
                
                element.className = `status-item ${success ? 'success' : 'error'}`;
            },
            
            addTestResult: function(message) {
                const resultsDiv = document.getElementById('test-results');
                const resultItem = document.createElement('div');
                resultItem.className = 'test-result-item';
                resultItem.textContent = message;
                resultsDiv.appendChild(resultItem);
            },
            
            updateFinalResults: function() {
                const total = Object.keys(this.results).length;
                const passed = Object.values(this.results).filter(r => r === true).length;
                const percentage = Math.round((passed / total) * 100);
                
                const finalResults = document.getElementById('final-results');
                finalResults.innerHTML = `
                    <div class="results-summary">
                        <h4>Resumen de Pruebas</h4>
                        <p><strong>Tests pasados:</strong> ${passed}/${total} (${percentage}%)</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percentage}%"></div>
                        </div>
                        <ul class="results-list">
                            ${Object.entries(this.results).map(([key, value]) => 
                                `<li class="${value ? 'success' : 'error'}">
                                    ${value ? 'âœ…' : 'âŒ'} ${key}: ${value ? 'OK' : 'Error'}
                                </li>`
                            ).join('')}
                        </ul>
                        ${percentage === 100 ? 
                            '<p class="success-message">ğŸ‰ Â¡Todos los sistemas estÃ¡n funcionando correctamente!</p>' : 
                            '<p class="warning-message">âš ï¸ Algunos sistemas necesitan revisiÃ³n</p>'
                        }
                    </div>
                `;
            }
        };
        
        // Inicializar cuando la pÃ¡gina estÃ© lista
        document.addEventListener('DOMContentLoaded', function() {
            TestSystem.init();
        });
    </script>
    
    <style>
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .test-section {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid #333;
        }
        
        .test-section h3 {
            color: #4a90e2;
            margin-bottom: 1rem;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0;
        }
        
        .status-item.success {
            color: #4caf50;
        }
        
        .status-item.error {
            color: #f44336;
        }
        
        .status-indicator {
            font-size: 1.2rem;
        }
        
        .status-detail {
            margin-top: 0.5rem;
            color: #888;
            font-size: 0.9rem;
        }
        
        .test-results {
            margin-top: 1rem;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 1rem;
        }
        
        .test-result-item {
            padding: 0.25rem 0;
            font-size: 0.9rem;
        }
        
        .final-results {
            background: #2a2a2a;
            border-radius: 8px;
            padding: 1.5rem;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
            margin: 1rem 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #45a049);
            transition: width 0.3s ease;
        }
        
        .results-list {
            list-style: none;
            padding: 0;
        }
        
        .results-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid #333;
        }
        
        .results-list li.success {
            color: #4caf50;
        }
        
        .results-list li.error {
            color: #f44336;
        }
        
        .success-message {
            color: #4caf50;
            font-weight: bold;
            text-align: center;
            font-size: 1.2rem;
        }
        
        .warning-message {
            color: #ff9800;
            font-weight: bold;
            text-align: center;
            font-size: 1.2rem;
        }
        
        .btn-primary, .btn-secondary {
            margin: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .btn-primary {
            background: #4a90e2;
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-primary:hover, .btn-secondary:hover {
            opacity: 0.8;
        }
    </style>
</body>
</html>
